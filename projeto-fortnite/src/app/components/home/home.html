
  <div class="container">
    <h2 *ngIf="usuario" class="text-start mb-4 text-warning fw-bold">Usuário logado: {{ usuario.usuario.nome }}</h2>
  </div>

<div class="container mt-5 mb-5">
  <h2 class="text-center mb-4 text-warning fw-bold">Cosméticos Fortnite</h2>
  <div class="accordion mb-4" id="accordionFiltros">
    <div class="accordion-item shadow-sm text-white" style="background-color: #212529;">
      <h2 class="accordion-header" id="headingFiltros">
        <button 
          class="accordion-button fw-bold" 
          type="button" 
          data-bs-toggle="collapse" 
          data-bs-target="#collapseFiltros" 
          aria-expanded="false" 
          aria-controls="collapseFiltros"
        >
          Filtrar Cosméticos
        </button>
      </h2>  
      <div 
        id="collapseFiltros" 
        class="accordion-collapse collapse" 
        aria-labelledby="headingFiltros" 
        data-bs-parent="#accordionFiltros"
      >
        <div class="accordion-body">  
          <div class="row g-3">            
            <div class="col-md-4">
              <label class="form-label fw-semibold">Nome</label>
              <input 
                type="text" 
                class="form-control" 
                placeholder="Digite o nome"
                [(ngModel)]="filtros.nome"
              >
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Tipo</label>
              <select 
                class="form-select" 
                [(ngModel)]="filtros.tipo"
              >
                <option value="">Todos</option>
                <option value="outfit">Outfit</option>
                <option value="backpack">Backpack</option>
                <option value="pickaxe">Pickaxe</option>
                <option value="emote">Emote</option>
                <option value="glider">Glider</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Raridade</label>
              <select 
                class="form-select" 
                [(ngModel)]="filtros.raridade"
              >
                <option value="">Todas</option>
                <option value="common">Common</option>
                <option value="uncommon">Uncommon</option>
                <option value="rare">Rare</option>
                <option value="epic">Epic</option>
                <option value="legendary">Legendary</option>
                <option value="mythic">Mythic</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Data de inclusão (inicial)</label>
              <input 
                type="date" 
                class="form-control"
                [max]="max"
                [(ngModel)]="filtros.dataInicio"
              >
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Data de inclusão (final)</label>
              <input 
                type="date" 
                class="form-control"
                [max]="max"
                [(ngModel)]="filtros.dataFim"
              >
            </div>  
            <div class="col-md-4 d-flex align-items-center">
              <div class="form-check form-switch">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  [(ngModel)]="filtros.apenasNovos"
                >
                <label class="form-check-label fw-semibold">Apenas cosméticos novos</label>
              </div>
            </div>            
          </div>  
          <div class="text-end mt-3">
            <button class="btn text-white me-2" style="background-color:#FF6F00; border-color:#FF6F00;" (click)="aplicarFiltros()">
              Filtrar
            </button>
            <button 
              class="btn btn-secondary" (click)="limparFiltros()">
              Limpar Filtros
            </button>
          </div>  
        </div>
      </div>
    </div>  
  </div>
    
  <div class="card card-shadow p-4 bg-dark text-light border-0">
    <div class="row g-4">
      <div class="col-12 d-flex justify-content-center text-center" *ngIf="carregando; else conteudo">
        <div class="spinner-border text-warning" role="status">
          <span class="visually-hidden">carregando...</span>
        </div>
      </div>
      <ng-template #conteudo>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3" *ngFor="let item of itensPaginados" >
          <div class="card h-100 border-0 card-dark" (click)="informacaoItemModal(item)" style="cursor: pointer;">
            <div class="d-flex align-items-center mt-3">
              <!-- <span class="badge bg-warning me-2">Item adquirido</span> -->
              <span class="badge bg-success" *ngIf="item.aVenda">Item a venda</span>
            </div>
            <img [src]="item.images?.icon || 'public/img/fortniteLogo.png'" class="card-img-top mt-2" alt="{{ item.name }}"/>
            <div class="card-body text-center">
              <h6 class="fw-bold">{{ item.name }}</h6> <br>
              <p class="mb-1 text-white">{{ item.type?.value }}</p>
              <span class="badge bg-primary" *ngIf="item.isNovo">Novo</span><br>
              <span class="badge px-3 py-2 text-uppercase" [style.backgroundColor]="buscarRaridadeColor(item.rarity?.value)">
                {{ item.rarity?.value || 'Desconhecida' }}
              </span><br>
              <div class="d-flex justify-content-center align-items-center gap-2 mt-2" *ngIf="item.aVenda">
                <img 
                  src="/icons8-v-bucks-48.png" alt="V-Bucks" style="width: 28px; height: 28px;"
                >
                <h6 class="m-0">{{ item.finalPrice }}</h6>
              </div>
              <button class="btn text-white mt-2" style="background-color: #FF6F00; border-color: #FF6F00;"  
                (click)="modalComprarItem(item);$event.stopPropagation()" *ngIf="isAuthenticated && item.aVenda">Comprar</button><br>
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <nav *ngIf="totalPaginas > 1" class="mt-4">
    <ul class="pagination justify-content-center flex-wrap">  
      <li class="page-item" [class.disabled]="paginaAtual === 1">
        <button class="page-link" (click)="mudarPagina(1)">Início</button>
      </li>

      <li class="page-item" [class.disabled]="paginaAtual === 1">
        <button class="page-link" (click)="mudarPagina(paginaAtual - 1)">Anterior</button>
      </li>

      <li
        class="page-item"
        *ngFor="let p of paginasVisiveis()"
        [class.active]="paginaAtual === p"
      >
        <button class="page-link" (click)="mudarPagina(p)">{{ p }}</button>
      </li>

      <li class="page-item" [class.disabled]="paginaAtual === totalPaginas">
        <button class="page-link" (click)="mudarPagina(paginaAtual + 1)">Próximo</button>
      </li>

      <li class="page-item" [class.disabled]="paginaAtual === totalPaginas">
        <button class="page-link" (click)="mudarPagina(totalPaginas)">Fim</button>
      </li>
    </ul>
  </nav>
</div>

<!-- Modal para comprar o item -->
<div class="modal fade show" *ngIf="tipoModal=='devolver-item'" tabindex="-1" [ngClass]="{ 'd-block': mostrarModal }" [style.background]="'rgba(0,0,0,0.5)'">  
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmação</h5>
        <button type="button" class="btn-close" (click)="fecharModal()"></button>
      </div>
      <div class="modal-body">
        <p>{{ mensagemModal }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="fecharModal()">Não</button>
        <button type="button" class="btn btn-primary" (click)="confirmarCompra()">Sim</button>
      </div>

    </div>
  </div>
</div>

<!-- Modal carregando -->
<div class="modal fade show" *ngIf="tipoModal === 'carregando'" tabindex="-1" [ngClass]="{ 'd-block': mostrarModal }" [style.background]="'rgba(0,0,0,0.5)'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <div class="modal-body">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
        <h5 class="mt-3">Carregando...</h5>
      </div>
    </div>
  </div>
</div>
<!-- Modal de sucesso -->
<div class="modal fade show" 
  *ngIf="tipoModal === 'sucesso'" tabindex="-1" [ngClass]="{ 'd-block': mostrarModal }" [style.background]="'rgba(0,0,0,0.5)'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <div class="modal-body">        
        <div class="text-success mb-3">
          <i class="bi bi-check-circle-fill" style="font-size: 3rem;"></i>
        </div>        
        <h5 class="fw-bold">{{ mensagemModal || 'Operação realizada com sucesso!' }}</h5>        
        <button class="btn btn-success mt-4" (click)="fecharModal()">
          OK
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Modal de erro -->
<div  class="modal fade show"  *ngIf="tipoModal === 'erro'"  tabindex="-1" [ngClass]="{ 'd-block': mostrarModal }" [style.background]="'rgba(0,0,0,0.5)'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <div class="modal-body">        
        <div class="text-danger mb-3">
          <i class="bi bi-x-circle-fill" style="font-size: 3rem;"></i>
        </div>
        <h5 class="fw-bold">{{ mensagemModal || 'Ocorreu um erro inesperado!' }}</h5>
        <button class="btn btn-danger mt-4" (click)="fecharModal()">
          Fechar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- modal de informação -->
<div  class="modal fade show" *ngIf="tipoModal === 'informacao-item'" tabindex="-1" [ngClass]="{ 'd-block': mostrarModal }"
  [style.background]="'rgba(0,0,0,0.5)'" >
<div class="modal-dialog modal-dialog-centered modal-lg">
  <div class="modal-content p-3">
    <div class="modal-header">
      <h5 class="modal-title">Informações do Item</h5>
      <button class="btn-close" (click)="fecharModal()"></button>
    </div>
    <div class="modal-body">
      <div class="row">        
        <div class="col-12 col-md-6 text-center">
          <img 
          [src]="itemSelecionado.images?.icon || 'public/img/fortniteLogo.png'"
            alt="Item" 
            class="img-fluid rounded"
            style="max-height: 250px; object-fit: contain;"
          />
        </div>
        <div class="col-12 col-md-6">
          <h4 class="fw-bold">{{ itemSelecionado.name }}</h4>
          <p class="mb-2">
            <b>Raridade:</b>
            <span 
              class="badge px-3 py-2"
              [ngStyle]="{ 'background-color': buscarRaridadeColor(itemSelecionado.rarity?.value), 'color': '#fff' }"
            >
              {{ itemSelecionado.rarity?.value | titlecase }}
            </span>
          </p>
          <p *ngIf="itemSelecionado.description">
            <b>Descrição:</b> {{ itemSelecionado.description }}
          </p>
          <div class="d-flex justify-content-start align-items-center gap-2 mt-2" *ngIf="itemSelecionado.aVenda">
            <img 
              src="/icons8-v-bucks-48.png" alt="V-Bucks" style="width: 28px; height: 28px;"
            >
            <p class="m-0">Valor: {{ itemSelecionado.finalPrice }}</p>
          </div>

        </div>
      </div>

    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="fecharModal()">Fechar</button>
    </div>

  </div>
</div>
</div>



